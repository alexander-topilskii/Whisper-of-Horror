## Name
GameLayout

## Purpose
Отрисовывает основной интерфейс настольного хоррор-приключения «Whisper of Horror». Компонент собирает каркас игры: верхний заголовок и четырёхколоночную основную зону с журналом хода, рукой игрока, состоянием мира и текущим событием. Журнал закреплён в первой колонке и напрямую наполняется данными из `GameState`, поэтому все панели синхронно реагируют на обновления от `GameEngine`.

## Visual Overview
```
┌──────────────────────────────────────────────────────────────────────────┐
│ HEADER: [WH LOGO]                                   [Новая][Настройки][🔊]│
├──────────────────────────────────────────────────────────────────────────┤
│ LOG (фикс.)   │ HAND (25%)      │ STATUS (35%)               │ EVENTS (25%)  │
│ ┌───────────┐ │ ┌─────────────┐ │ ┌───────────────┐ ┌──────┐ │ ┌───────────┐ │
│ │Журнал     │ │ │Ресурсы      │ │ │Треки победы  │ │NPC   │ │ │Событие    │ │
│ │[Запись]   │ │ │○○○ Действия │ │ │██░░░░░░      │ │row   │ │ │Flavor     │ │
│ │[Запись]   │ │ │Колода/Сброс │ │ ├───────────────┤ ├──────┤ │ │Выбор      │ │
│ │...        │ │ │Рука (5)     │ │ │Фаза/статусы  │ │Статы│ │ │Колода     │ │
│ └───────────┘ │ └─────────────┘ │ └───────────────┘ └──────┘ │ └───────────┘ │
└──────────────────────────────────────────────────────────────────────────┘
```

- Фон: тёмно-зелёный, с лёгким свечением.
- Акцент «Расследование»: бирюзово-зелёные полосы, «Разрушение»: красно-ржавые огни.
- Карточки игрока и NPC — закруглённые прямоугольники с мягким свечением и границами.
- Жетоны действий — три окружности; неактивные могут терять подсветку.
- Лог закреплён в первой колонке, растягивается на всю высоту панели и прокручивается отдельно от остальных блоков.
- Hover/фокус карточек — лёгкий подъём и подсветка контура.

### State variants
- **Карты руки:** обычные, при наведении/клике увеличивают контраст и показывают тултип. Непроигрываемые отображаются с приглушённой насыщенностью.
- **Статусы персонажа:** при критических значениях блок подсвечивается и пульсирует.
- **Эффекты/NPC:** чипы и карточки показывают тултипы, при активации фиксируются.
- **Журнал:** рендерится внутри первой колонки, использует те же стили панелей и автоскроллит новые записи при активном флаге.

## Behavior
- В конструкторе компонент вставляет готовую разметку и подключает стили.
- Клик или клавиша `Enter`/`Space` по элементам с тултипом переключает их состояние `data-expanded`, обеспечивая работу на тач-устройствах.
- Hover/фокус активируют CSS-тултип с подробностями (карты, эффекты, NPC).
- Карточки руки, эффекты и NPC используют класс `woh-tooltip` для вывода всплывающих описаний.
- Метод `renderLog` отвечает за колонку журнала: он генерирует элементы, сбрасывает пустое состояние и управляет автоскроллом.

## API (Props / Inputs / Outputs)
| Name | Type | Default | Description |
|------|------|---------|-------------|
| `root` | `HTMLElement` | — | Контейнер, в который будет встроен интерфейс. Передаётся в конструктор. |
| `bind(engine)` | `GameEngine` | — | Привязывает layout к экземпляру `GameEngine` и включает обработку команд. |
| `render(state)` | `GameState` | — | Полностью перерисовывает UI по текущему снимку состояния. Вызывается движком или подписчиком. |

## States and Examples
- **Стандартное состояние:** `render` создаёт карточки руки, индикаторы колоды, треки и лог согласно данным из `GameState`.
- **Критический рассудок:** карточка `Рассудок` автоматически получает класс `is-critical`, когда `value <= criticalThreshold`.
- **Непроигрываемые карты:** `data-playable="false"` подсвечивает недоступные карты, команда `PlayCardCommand` регистрирует попытку в логе.
- **Активированный тултип:** клик по элементу с классом `woh-tooltip` переключает `data-expanded`, все остальные тултипы закрываются.
- **Реакция на команды:** `data-command="play-card"` и `data-command="resolve-choice"` транслируют пользовательские клики в `GameEngine.dispatch`.
- **Адаптивность:** при ширине <900px блоки переходят в один столбец, при <600px и <380px уменьшаются отступы, панели и кнопки тянутся на всю ширину.

- **Инициализация:** вызвать `new GameLayout(root)` — инжектятся стили, создаётся базовая разметка, навешиваются делегированные обработчики тултипов и команд.
- **Привязка:** `layout.bind(engine)` сохраняет ссылку на `GameEngine` и активирует кнопки `Новая партия`, `Настройки`, `🔊/🔇`, а также делегированные клики по картам и вариантам события.
- **Обновление:** `engine.subscribe((state) => layout.render(state))` или ручной вызов `render(state)` обновляет все динамические блоки.
- **Уничтожение:** очистить контейнер и (при необходимости) отписаться от движка. Дополнительных ручных `removeEventListener` не требуется — обработчики висят на корневом контейнере.
- **Зависимости:** только браузерный `structuredClone` через `GameEngine`; внешние библиотеки не используются.

## Integration Example
```ts
import initialState from "../../src/data/initial-state";
import { GameEngine, PlayCardCommand } from "../game-engine/game-engine";
import { GameLayout } from "../game-layout/game-layout";

const mount = document.getElementById("app");
if (!mount) throw new Error("Missing #app container");

const engine = new GameEngine(initialState);
const layout = new GameLayout(mount);

layout.bind(engine);
layout.render(engine.getState());

engine.subscribe((state) => layout.render(state));
engine.dispatch(new PlayCardCommand("lantern"));
```
